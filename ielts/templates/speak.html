<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <a href="{% url 'home' %}" style="text-decoration: none; display: block; text-align: left; margin-top: 10px; margin-left: 5px;">
        <button style="padding: 10px; background-color: #ff0000; color: #fff; border: none; cursor: pointer;
                        border-radius: 8px; font-family: Arial, sans-serif;">
            Home
        </button>
    </a>

    <title>Record Audio</title>
</head>
<body>
    <h1>Record Audio</h1>
    <br>
    <form id="record-form" method="post" enctype="multipart/form-data">
        <label for="audio_file">Upload audio file:</label>
        <input type="file" name="audio" id="audio_file" accept="audio/*">
        <br><br>
        <label for="audio_data">Record audio directly:</label>
        <button id="record-btn">Start Recording</button>
        <button id="stop-btn" disabled>Stop Recording</button>
        <br><br>
        <input type="hidden" name="audio_data" id="audio_data">
        <button type="button" onclick="submitAudio()">Submit</button>
    </form>

    <script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
    <script>
        const recorder = new Recorder(navigator.mediaDevices.getUserMedia({ audio: true }));
        const recordBtn = document.getElementById('record-btn');
        const stopBtn = document.getElementById('stop-btn');
        const audioDataInput = document.getElementById('audio_data');

        function submitAudio() {
            if (audioDataInput.value || document.getElementById('audio_file').files.length > 0) {
                // Submit form with audio data
                document.getElementById('record-form').submit();
            } else {
                alert("Please upload an audio file or record your audio first.");
            }
        }

        recordBtn.addEventListener('click', async () => {
            await recorder.start();
            recordBtn.disabled = true;
            stopBtn.disabled = false;
        });

        stopBtn.addEventListener('click', async () => {
            await recorder.stop();
            const blob = await recorder.exportWAV();
            const audioData = await blob.arrayBuffer();

            audioDataInput.value = btoa(String.fromCharCode.apply(null, new Uint8Array(audioData)));

            recordBtn.disabled = false;
            stopBtn.disabled = true;
        });
    </script>
</body>
</html>
